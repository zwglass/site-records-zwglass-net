(self.webpackChunkclient_admin_v102=self.webpackChunkclient_admin_v102||[]).push([[8781],{6132:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(7294),a=s(o),l=s(r(5697));function s(e){return e&&e.__esModule?e:{default:e}}var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.scrollListener=r.scrollListener.bind(r),r.eventListenerOptions=r.eventListenerOptions.bind(r),r.mousewheelListener=r.mousewheelListener.bind(r),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"componentDidMount",value:function(){this.pageLoaded=this.props.pageStart,this.options=this.eventListenerOptions(),this.attachScrollListener()}},{key:"componentDidUpdate",value:function(){if(this.props.isReverse&&this.loadMore){var e=this.getParentElement(this.scrollComponent);e.scrollTop=e.scrollHeight-this.beforeScrollHeight+this.beforeScrollTop,this.loadMore=!1}this.attachScrollListener()}},{key:"componentWillUnmount",value:function(){this.detachScrollListener(),this.detachMousewheelListener()}},{key:"isPassiveSupported",value:function(){var e=!1,t={get passive(){e=!0}};try{document.addEventListener("test",null,t),document.removeEventListener("test",null,t)}catch(r){}return e}},{key:"eventListenerOptions",value:function(){this.props.useCapture;return this.isPassiveSupported()?{useCapture:this.props.useCapture,passive:!0}:{passive:!1}}},{key:"setDefaultLoader",value:function(e){this.defaultLoader=e}},{key:"detachMousewheelListener",value:function(){var e=window;!1===this.props.useWindow&&(e=this.scrollComponent.parentNode),e.removeEventListener("mousewheel",this.mousewheelListener,this.options?this.options:this.props.useCapture)}},{key:"detachScrollListener",value:function(){var e=window;!1===this.props.useWindow&&(e=this.getParentElement(this.scrollComponent)),e.removeEventListener("scroll",this.scrollListener,this.options?this.options:this.props.useCapture),e.removeEventListener("resize",this.scrollListener,this.options?this.options:this.props.useCapture)}},{key:"getParentElement",value:function(e){var t=this.props.getScrollParent&&this.props.getScrollParent();return null!=t?t:e&&e.parentNode}},{key:"filterProps",value:function(e){return e}},{key:"attachScrollListener",value:function(){var e=this.getParentElement(this.scrollComponent);if(this.props.hasMore&&e){var t=window;!1===this.props.useWindow&&(t=e),t.addEventListener("mousewheel",this.mousewheelListener,this.options?this.options:this.props.useCapture),t.addEventListener("scroll",this.scrollListener,this.options?this.options:this.props.useCapture),t.addEventListener("resize",this.scrollListener,this.options?this.options:this.props.useCapture),this.props.initialLoad&&this.scrollListener()}}},{key:"mousewheelListener",value:function(e){1!==e.deltaY||this.isPassiveSupported()||e.preventDefault()}},{key:"scrollListener",value:function(){var e=this.scrollComponent,t=window,r=this.getParentElement(e),n=void 0;if(this.props.useWindow){var o=document.documentElement||document.body.parentNode||document.body,a=void 0!==t.pageYOffset?t.pageYOffset:o.scrollTop;n=this.props.isReverse?a:this.calculateOffset(e,a)}else n=this.props.isReverse?r.scrollTop:e.scrollHeight-r.scrollTop-r.clientHeight;n<Number(this.props.threshold)&&e&&null!==e.offsetParent&&(this.detachScrollListener(),this.beforeScrollHeight=r.scrollHeight,this.beforeScrollTop=r.scrollTop,"function"==typeof this.props.loadMore&&(this.props.loadMore(this.pageLoaded+=1),this.loadMore=!0))}},{key:"calculateOffset",value:function(e,t){return e?this.calculateTopPosition(e)+(e.offsetHeight-t-window.innerHeight):0}},{key:"calculateTopPosition",value:function(e){return e?e.offsetTop+this.calculateTopPosition(e.offsetParent):0}},{key:"render",value:function(){var e=this,t=this.filterProps(this.props),r=t.children,n=t.element,o=t.hasMore,l=(t.initialLoad,t.isReverse),s=t.loader,i=(t.loadMore,t.pageStart,t.ref),c=(t.threshold,t.useCapture,t.useWindow,t.getScrollParent,function(e,t){var r={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(t,["children","element","hasMore","initialLoad","isReverse","loader","loadMore","pageStart","ref","threshold","useCapture","useWindow","getScrollParent"]));c.ref=function(t){e.scrollComponent=t,i&&i(t)};var u=[r];return o&&(s?l?u.unshift(s):u.push(s):this.defaultLoader&&(l?u.unshift(this.defaultLoader):u.push(this.defaultLoader))),a.default.createElement(n,c,u)}}]),t}(o.Component);i.propTypes={children:l.default.node.isRequired,element:l.default.node,hasMore:l.default.bool,initialLoad:l.default.bool,isReverse:l.default.bool,loader:l.default.node,loadMore:l.default.func.isRequired,pageStart:l.default.number,ref:l.default.func,getScrollParent:l.default.func,threshold:l.default.number,useCapture:l.default.bool,useWindow:l.default.bool},i.defaultProps={element:"div",hasMore:!1,initialLoad:!0,pageStart:0,ref:null,threshold:250,useWindow:!0,isReverse:!1,useCapture:!1,loader:null,getScrollParent:null},t.default=i,e.exports=t.default},1554:function(e,t,r){e.exports=r(6132)},3526:function(e,t,r){"use strict";var n=r(7294),o=r(7371),a=r(903),l=function(e){var t=e.multipleObjKeys,r=e.oldImageUrlsObj,l=e.uploadedHandle,s=(0,n.useRef)({});(0,n.useEffect)((function(){s.current={}}),[r]);var i=function(e,t){var r=Object.keys(e);r.includes("id")&&r.includes("image_cos_name")&&function(e,t){console.log(t);var r=Object.assign({},s.current);r[t]=e,s.current=r,l(r)}({id:e.id,image_cos_name:e.image_cos_name,image_cos_name_url:e.image_cos_name_url},t)};return n.createElement("div",{style:{width:"100%",height:"auto",textAlign:"center",margin:"0.5rem",border:"medium double rgb(250,0,255)",padding:"0.5rem"}},n.createElement(o.Z,{direction:"vertical",size:"middle"},t.map((function(e){return n.createElement(a.Z,{key:e.toString(),oldImageUrl:Object.keys(r).includes(e)?r[e]:"",avatarSize:"96px",uploadedResponseHandle:i,fileKey:e})}))),n.createElement("br",null))};l.defaultProps={multipleObjKeys:["image_cos_name1","image_cos_name2","image_cos_name3","image_cos_name4","image_cos_name5"],oldImageUrlsObj:{},uploadedHandle:function(e){console.log(e)}},t.Z=l},6844:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return de}});var n=r(7294),o=r(4564),a=r(6079),l=r(1152),s=r(3299),i=r(8146),c=r(3148),u=r(6452),d=r(2184),m=r(7371),p=r(2889),f=r(8654),h=r(6858),g=r(5663),v=r(9726),_=r(3765),E=r(6643),y=r(5455),b=r(1554),Z=r.n(b),C=r(8692),S=r(1413),k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M257.7 752c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9zm67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z"}}]},name:"edit",theme:"outlined"},P=r(7041),O=function(e,t){return n.createElement(P.Z,(0,S.Z)((0,S.Z)({},e),{},{ref:t,icon:k}))};O.displayName="EditOutlined";var L=n.forwardRef(O),w=r(3526),j=function(e){var t=e.modalState,r=e.setModalState,o=e.selectCustomerHandle,a=e.clickCreatedCustomerHandle;return n.createElement(n.Fragment,null,n.createElement(f.Z,{visible:t,title:"选择顾客",footer:[n.createElement(s.Z,{key:"back",onClick:function(){r(!1)}},"取消")]},n.createElement(v.Z,{selectCustomerHandle:o,clickCreatedCustomerHandle:a})))};j.defaultProps={modalState:!1,setModalState:function(e){console.log(e)},selectCustomerHandle:function(e){console.log(e)},clickCreatedCustomerHandle:function(e){console.log(e)}};var M=j,R=r(9952),H=r(5604),I=function(e){var t=e.reqParams,r=e.requestCount,o=e.responseDataHandle;return n.createElement(H.Z,{responseDataHandle:o,api:"records-admin/v1/purchaserecord",method:"get",reqParams:t,reqObject:{},requestCount:r})};I.defaultProps={reqParams:{page:1},requestCount:0,responseDataHandle:function(e){console.log(e)}};var q=function(e){var t=e.method,r=e.recordId,o=e.reqObject,a=e.requestCount,l=e.responseDataHandle,s="post"===t?"records-admin/v1/purchaserecord":"records-admin/v1/purchaserecord/"+r;return n.createElement(H.Z,{responseDataHandle:l,api:s,method:t,reqParams:{},reqObject:o,requestCount:a})};q.defaultProps={method:"post",recordId:0,reqObject:{},requestCount:0,responseDataHandle:function(e){console.log(e),Object.keys(e).includes("code")&&1e3===e.code?(_.ZP.success("Success"),_.ZP.success("更新顾客购买记录成功")):(_.ZP.error("Error"),_.ZP.error("Error: 更新失败"))}};var D=function(e){var t=e.recordId,r=e.setRecordId,o=e.deltetPurchaseRecordCount,a="records-admin/v1/purchaserecord/"+t;return n.createElement(H.Z,{responseDataHandle:function(e){console.log("Deleted",e),r(0)},api:a,method:"delete",reqParams:{},reqObject:{},requestCount:o})};D.defaultProps={recordId:0,setRecordId:function(e){console.log(e)},deltetPurchaseRecordCount:0};var x=r(2486),T=r(1903),F={id:0,customer_id:0,product_title:"",diopter_r:"",diopter_l:"",pupillary_distance:"",receive_address:"",products_quantity:0,purchase_amount:0,sale_platform:0,order_state:0,add_time:"",update_time:"",explains:"",image_cos_name1:"",image_cos_name2:"",image_cos_name3:"",image_cos_name4:"",image_cos_name5:""},A={id:"订单ID",customer_id:"顾客ID",product_title:"商品名称",diopter_r:"光度R",diopter_l:"光度L",pupillary_distance:"瞳距PD",receive_address:"收货地址",products_quantity:"商品数量",purchase_amount:"总金额",sale_platform:"销售平台",order_state:"订单状态",add_time:"创建时间",update_time:"更新时间",explains:"说明",image_cos_name1:"图片1",image_cos_name2:"图片2",image_cos_name3:"图片3",image_cos_name4:"图片4",image_cos_name5:"图片5"},Y=["id","customer_id","add_time","update_time"],z=["image_cos_name1","image_cos_name2","image_cos_name3","image_cos_name4","image_cos_name5"],W=n.createElement(x.A,{options:[{value:0,label:"订单交易完成"},{value:1,label:"定制中"},{value:2,label:"已发货"}]}),N={sale_platform:n.createElement(T.Z,null),order_state:W},V=y.Z.formCommonStyle,U=V.layoutForm,K=V.formItemLayout,B=V.tailFormItemLayout,G=f.Z.confirm,J=function(e){var t=e.purchaseRecordEditModalState,r=e.setPurchaseRecordEditModalState,o=e.recordObj,a=e.reloadRecords,i=l.Z.useForm()[0],h=(0,n.useState)(0),v=h[0],_=h[1],E=(0,n.useState)(0),y=E[0],b=E[1],Z=(0,n.useState)(""),S=Z[0],k=Z[1],P=(0,n.useState)(""),O=P[0],j=P[1],H=(0,n.useRef)(0),I=(0,n.useState)(!1),x=I[0],T=I[1],W=(0,n.useRef)({}),V=(0,n.useState)({}),J=V[0],Q=V[1],X=(0,n.useRef)({}),$=(0,n.useState)(0),ee=$[0],te=$[1];(0,n.useEffect)((function(){console.log(o),k(""),j(""),H.current=o.customer_id,i.setFieldsValue(o);for(var e={},t=0;t<z.length;t++){var r=z[t];e[r]=o[r]}Q(e)}),[o]);var re=function(e){var t=Object.keys(e).includes("customer_id")?1:0,r=e.name,n=e.id,o=e.avatar;1===t&&(r=e.wx_nickname,n=e.customer_id,o=e.wx_avatar),k(r),i.setFieldsValue({customer_id:n}),T(!1),j(o)};return n.createElement(f.Z,{getContainer:!1,title:"订单详情",visible:t,footer:null,closable:!1},n.createElement(R.fC,{customerId:H.current,responseDataHandle:function(e){k(""),j(""),setTimeout((function(){Object.keys(e).includes("results")&&Array.isArray(e.results)&&e.results.length>0&&(k(e.results[0].name),j(e.results[0].avatar))}),1e3)}}),n.createElement(c.Z,{gutter:16},n.createElement(u.Z,{span:12},n.createElement("h3",null,"昵称: ",S)),n.createElement(u.Z,{span:8},O.length>10?n.createElement("img",{height:"64px",alt:"Avatar",src:O}):null),n.createElement(u.Z,{span:4},n.createElement(m.Z,null,n.createElement(p.Z,{title:"删除当前顾客"},n.createElement(s.Z,{onClick:function(){G({title:"确定删除用户"+S+"吗?",icon:n.createElement(C.Z,null),content:"如果误删, 可以点击取消!",onOk:function(){k(""),i.setFieldsValue({customer_id:0}),j("")},onCancel:function(){console.log("Cancel")}})},shape:"circle",icon:n.createElement(g.Z,null)})),n.createElement(p.Z,{title:"选择或新建顾客"},n.createElement(s.Z,{type:"primary",onClick:function(){T(!0)},shape:"circle",icon:n.createElement(L,null)}))))),n.createElement("br",null),n.createElement(R.Lw,{customerId:H.current,responseDataHandle:function(e){setTimeout((function(){if(Object.keys(e).includes("results")&&Array.isArray(e.results)&&e.results.length>0){var t=S.length>1?S.length:e.results[0].wx_nickname,r=O.length>10?O:e.results[0].wx_avatar;k(t),j(r)}}),2e3)}}),n.createElement("br",null),n.createElement("hr",null),n.createElement("br",null),n.createElement(w.Z,{multipleObjKeys:z,oldImageUrlsObj:J,uploadedHandle:function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r].image_cos_name);console.log(t),W.current=t}}),n.createElement(l.Z,Object.assign({},U,{form:i,name:"purchaserecord",layout:"horizontal",initialValues:F,onFinish:function(e){console.log(W.current),X.current=Object.assign({},e,W.current),console.log(X.current),te(ee+1),a()},size:"large"}),Object.keys(F).map((function(e,t){return z.includes(e)?null:n.createElement(l.Z.Item,Object.assign({},K,{label:A[e],name:e,key:t.toString()}),Object.keys(N).includes(e)?N[e]:n.createElement(d.Z,{disabled:Y.includes(e)}))})),n.createElement(l.Z.Item,B,n.createElement(m.Z,null,n.createElement(s.Z,{type:"primary",htmlType:"submit"},"提交"),n.createElement(s.Z,{htmlType:"button",onClick:function(){return r(!1)}},"取消"),n.createElement(s.Z,{htmlType:"button",onClick:function(){console.log("Error"),G({title:"确定要删除当前订单吗?",icon:n.createElement(C.Z,null),content:"订单删除后将无法恢复...",onOk:function(){console.log(o),_(o.id),b(y+1),a()},onCancel:function(){}})}},"删除订单")))),n.createElement(q,{method:"put",recordId:o.id,reqObject:X.current,requestCount:ee}),n.createElement(D,{recordId:v,setRecordId:_,deltetPurchaseRecordCount:y}),n.createElement(M,{modalState:x,setModalState:T,selectCustomerHandle:re,clickCreatedCustomerHandle:re}))};J.defaultProps={reloadRecords:function(){console.log("Reload pruchase records...")}};var Q=J,X=r(9378),$=y.Z.purchaseStates,ee=y.Z.salePlatforms,te=function(e){var t=e.queryFactor,r=(0,n.useState)([]),o=r[0],a=r[1],l=(0,n.useRef)(!0),i=(0,n.useState)({loading:!1,hasMore:!0}),c=i[0],u=i[1],d=(0,n.useState)(!1),m=d[0],p=d[1],f=(0,n.useState)({}),h=f[0],g=f[1],v=(0,n.useState)(0),y=v[0],b=v[1],C=(0,n.useRef)({page:0}),S=function(){l.current?(C.current=Object.assign({page:C.current.page+1},t),b(y+1),console.log(y),u({loading:!0})):console.log("No More...")};(0,n.useEffect)((function(){k()}),[t]);var k=function(){a([]),l.current=!0,u({loading:!1}),C.current.page=0,S()};return n.createElement(n.Fragment,null,n.createElement("div",{className:"purchase-records-infinite-container"},n.createElement(Z(),{initialLoad:!1,pageStart:0,loadMore:S,hasMore:!c.loading&&l.current,useWindow:!1},n.createElement("p",null,"订单列表"),n.createElement(E.ZP,{itemLayout:"vertical",dataSource:o,renderItem:function(e){return n.createElement(E.ZP.Item,{extra:n.createElement(X.Z,{alt:"Image",width:"64px",src:e.image_cos_name1}),actions:[n.createElement(s.Z,{onClick:function(){return t=e,p(!0),void g(t);var t},type:"link"},"详情")]},n.createElement(E.ZP.Item.Meta,{title:"商品: "+e.product_title+"; 时间: "+e.add_time+";  销售平台: "+ee[e.sale_platform]+"; 订单状态: "+$[e.order_state]+";",description:"说明: "+e.explains+";"}))}}),n.createElement(I,{className:"loading-container",reqParams:C.current,requestCount:y,responseDataHandle:function(e){if(console.log(e),l.current=!1,u({loading:!1}),!e||1e3!==e.code)return _.ZP.error("Error Netword..."),void _.ZP.error("网络错误...");e.next&&(l.current=!0,u({loading:!1})),Array.isArray(e.results)?a(o.concat(e.results)):console.log(e.results),p(!1)}}))),n.createElement(Q,{purchaseRecordEditModalState:m,setPurchaseRecordEditModalState:p,recordObj:h,reloadRecords:k}))};te.defaultProps={queryFactor:{}};var re=te,ne=a.Z.RangePicker,oe={customername:"",add_time:[],sale_platform:0},ae=y.Z.formCommonStyle,le=ae.layoutForm,se=ae.formItemLayout,ie=ae.tailFormItemLayout,ce=function(){var e=(0,n.useState)({}),t=e[0],r=e[1],o=l.Z.useForm()[0],a=(0,n.useState)(!1),_=a[0],E=a[1],y=(0,n.useState)(!1),b=y[0],Z=y[1],C=(0,n.useRef)({});return n.createElement(n.Fragment,null,n.createElement(s.Z,{type:"primary",onClick:function(){E(!0)}},n.createElement(h.Z,null)," Search"),n.createElement(i.Z,{title:"销售记录查询",width:"100%",height:"400px",placement:"top",onClose:function(){return E(!1)},visible:_,bodyStyle:{paddingBottom:80},footer:null},n.createElement(l.Z,Object.assign({},le,{layout:"horizontal",form:o,name:"query-records",onFinish:function(e){console.log(e);var t=e.add_time,n=Array.isArray(t)&&t.length>1?[t[0].format("YYYY-MM-DD"),t[1].format("YYYY-MM-DD")]:null,o={},a=Object.keys(C.current).includes("customer_id")?C.current.customer_id:Object.keys(C.current).includes("id")?C.current.id:0;a>0&&(o.customer_id=a),e.sale_platform>0&&(o.sale_platform=e.sale_platform),n&&(o.add_time_start=n[0],o.add_time_end=n[1]),console.log(o),r(o),E(!1)},initialValues:oe}),n.createElement(l.Z.Item,Object.assign({},se,{label:"顾客"}),n.createElement(c.Z,{gutter:8},n.createElement(u.Z,{span:18},n.createElement(l.Z.Item,{name:"customername",noStyle:!0},n.createElement(d.Z,{disabled:!0}))),n.createElement(u.Z,{span:6},n.createElement(m.Z,null,n.createElement(p.Z,{title:"清除选中顾客"},n.createElement(s.Z,{type:"dashed",onClick:function(){o.setFieldsValue({customername:""}),C.current={}},shape:"circle",icon:n.createElement(g.Z,null)})),n.createElement(p.Z,{title:"选择或新建顾客"},n.createElement(s.Z,{type:"primary",onClick:function(){Z(!0)},shape:"circle",icon:n.createElement(h.Z,null)})))))),n.createElement(l.Z.Item,Object.assign({},se,{label:"日期",name:"add_time",style:{marginBottom:0}}),n.createElement(ne,null)),n.createElement(l.Z.Item,Object.assign({},se,{label:"销售平台",name:"sale_platform"}),n.createElement(T.Z,null)),n.createElement(l.Z.Item,ie,n.createElement(m.Z,null,n.createElement(s.Z,{onClick:function(){return E(!1)}},"取消"),n.createElement(s.Z,{type:"primary",htmlType:"submit"},"查询"))))),n.createElement(re,{queryFactor:t}),n.createElement(f.Z,{visible:b,title:"选择顾客",footer:[n.createElement(s.Z,{key:"back",onClick:function(){Z(!1)}},"取消")]},n.createElement(v.Z,{selectCustomerHandle:function(e){C.current=e;var t=Object.keys(e),r=t.includes("name")?e.name:t.includes("wx_nickname")?e.wx_nickname:"";o.setFieldsValue({customername:r}),Z(!1)}})))},ue=r(262),de=function(){return n.createElement(o.Z,null,n.createElement(ue.Z,{title:"Records"}),n.createElement(ce,null))}}}]);
//# sourceMappingURL=component---src-pages-queryeditrecords-js-50e6b86d7f8737f932ff.js.map