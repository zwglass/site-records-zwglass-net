"use strict";(self.webpackChunkclient_admin_v102=self.webpackChunkclient_admin_v102||[]).push([[3578],{3747:function(e,t,n){n.r(t),n.d(t,{default:function(){return F}});var o=n(7294),a=n(4564),s=n(262),l=n(3765),r=n(3148),i=n(6452),c=n(7371),u=n(2889),d=n(3299),m=n(4167),p=n(3229),f=n(5604),g=n(8102),_=n(3964),b=n.n(_),h=n(2486),v=["id","name","special_sale"],E=["id","name"],C=["image"],O={id:"ID",name:"品名",channel_id:"频道",categories:"分类",sort_order:"排序顺序",freight_template_id:"快递模版ID",freight_type:"快递类别",goods_brief:"商品简介",goods_number:"商品数量",goods_unit:"单位",has_done:"有现货",has_gallery:"已推广",is_delete:"已下架",is_index:"在序列",is_new:"是新品",is_on_sale:"已上架",keywords:"关键词",cost_price:"成本价",min_cost_price:"最低成本价",min_retail_price:"最低零售价",retail_price:"零售价",sell_volume:"销售数量",https_pic:"链接图",goods_desc:"详情页",list_pic:"主图",home_pic1:"主图1",home_pic2:"主图2",home_pic3:"主图3",home_pic4:"主图4",home_pic5:"主图5",home_pic6:"主图6",home_pic7:"主图7",home_pic8:"主图8",home_pic9:"主图9",goods_video:"商品视频",handle_staff_id:"操作员ID",add_time:"创建时间",update_time:"更新时间",explains:"说明",special_sale:"今日特价商品"},q={special_sale:o.createElement(h.A,{options:[{value:0,label:"否"},{value:1,label:"是"}]})},j=function(e){return{goods_id:{buttonTips:"选择商品",clickMethod:function(){return e(1)}}}},k={password:[{required:!0,message:"Please input Password!"}]},S=["home_pic"],y=["goods-admin/v1/specialgoods","goods-admin/v1/goods"],P=function(e,t,n,a){var s=[o.createElement(d.Z,{onClick:function(){n(e),t(2)},type:"link"},"详情")];return a&&s.push(o.createElement(d.Z,{onClick:function(){return a(e)},type:"link"},"选择")),s},Z=function(e,t,n,a,s){var l=o.createElement("div",null,o.createElement("p",null,"商品ID: "+e.id),o.createElement("p",null,"是今日特价商品: "+(e.special_sale>0?"是":"否"))),r={id:e.id,actions:P(e,a,t,n),img:e.home_pic1_url,avatar:"",title:"商品标题:  "+e.name+";",content:l};return(0,p.l)(r,180)},D=function(e){var t=e.requestCount,n=e.reqParams,a=e.responseDataHandle,s=y[0];return o.createElement(f.Z,{responseDataHandle:a,api:s,method:"get",reqParams:n,reqObject:{},requestCount:t})};D.defaultProps={requestCount:0,reqParams:{},responseDataHandle:function(e){console.log(e)}};var H=function(e){var t=e.requestCount,n=e.reqObject,a=e.responseDataHandle,s=e.id,l=[].concat(y)[0]+"/"+s;return o.createElement(f.Z,{responseDataHandle:a,api:l,method:"put",reqParams:{},reqObject:n,requestCount:t})};H.defaultProps={requestCount:0,reqObject:{},responseDataHandle:function(e){console.log(e)},id:0};var I=function(e){var t=e.requestCount,n=e.responseDataHandle,a=e.id,s=[].concat(y)[0]+"/"+a;return o.createElement(f.Z,{responseDataHandle:n,api:s,method:"delete",reqParams:{},reqObject:{},requestCount:t})};I.defaultProps={requestCount:0,responseDataHandle:function(e){console.log(e)},id:0};var L=n(8654),w=n(6306),x=n(7047),R=n(5071),B=n(4677),K=function(e){var t=e.visible,n=e.setVisible,a=e.oldObj,s=e.reloadListCount,r=e.setReloadListCount,i=(0,o.useRef)({}),c=(0,o.useState)(0),u=c[0],d=c[1],m=(0,o.useRef)({}),p=(0,o.useState)(0),f=p[0],g=p[1],_=(0,o.useState)(0),h=_[0],y=_[1],P=(0,o.useState)({}),Z=P[0],D=P[1];(0,o.useEffect)((function(){if(t>0){console.log(a),D({id:-1});var e=a.end_time?parseInt(a.end_time):0;e<1e10&&(e=parseInt(1e3*e));var n=b()(e);D(Object.assign({},a,{end_time:n}))}}),[t,a]);return o.createElement(L.Z,{visible:2===t,title:"SpecialGoods",closable:!1,footer:null},o.createElement("div",{style:{width:"100%",height:"auto",textAlign:"center"}},o.createElement(x.DX,{maxImagesNum:9,imageKeyName:S[0],oldObj:a,onChange:function(e){i.current=e,console.log(e)}})),o.createElement(w.Z,null),o.createElement(R.y,{columns:v,disabledKeys:E,notShowKeys:C,formKeyLabelObj:O,formKeySelectComponentsObj:q,formKeysItemButtonObj:j(y),onFinish:function(e){var t=Object.assign({},e,i.current);console.log(t),t.end_time=parseInt(b().unix(t.end_time).unix()/1e3),console.log(t.end_time),m.current=t,d(u+1)},cancelHandle:function(){return n(0)},showDeleteButton:!0,deleteHandle:function(){g(f+1),r(s+1)},updateFormObj:Z,rulesObj:k}),o.createElement(B.Y,{modalState:1===h,setModalState:y,selectHandle:function(e){console.log(e),D({goods_id:e.id}),y(0)}}),o.createElement(H,{requestCount:u,reqObject:m.current,responseDataHandle:function(e){Object.keys(e).includes("code")&&1e3===e.code?(l.ZP.success("修改成功"),r(s+1),n(0)):l.ZP.error("网络错误...")},id:a.id}),o.createElement(I,{requestCount:f,responseDataHandle:function(e){return n(0)},id:a.id}))};K.defaultProps={visible:!1,setVisible:function(e){return console.log(e)},oldObj:{}};var V=K,G=n(5765),M=function(e){var t=e.reloadListCount,n=e.setReloadListCount,a=e.requestParams,s=e.selectButtonOnClick,l=(0,o.useState)(0),r=l[0],i=l[1],c=(0,o.useState)(!0),u=c[0],d=c[1],m=(0,o.useState)(!1),f=m[0],g=m[1],_=(0,o.useState)(!1),b=_[0],h=_[1],v=(0,o.useRef)({page:0}),E=(0,o.useState)([]),C=E[0],O=E[1],q=(0,o.useState)(0),j=q[0],k=q[1],S=(0,o.useState)({}),y=S[0],P=S[1];(0,o.useEffect)((function(){u&&!f&&b&&(H(),h(!1))}),[b,u,f]),(0,o.useEffect)((function(){v.current=Object.assign({},a),I()}),[t]);var H=function(){if(u&&!f){g(!0),d(!1);var e=Number.isInteger(v.current.page)?v.current.page+1:1;v.current=Object.assign({},v.current,{page:e}),console.log(v.current),k(j+1)}else console.log("Error state: hasMore is ",u,", loading is ",f)},I=function(){v.current=Object.assign({},v.current,{page:0}),O([]),d(!0),g(!1),h(!0)};return o.createElement("div",null,o.createElement(D,{requestCount:j,reqParams:v.current,responseDataHandle:function(e){g(!1),Object.keys(e).includes("code")&&1e3===e.code&&Object.keys(e).includes("results")?(O(C.concat(e.results)),d(function(e){return!!(Object.keys(e).includes("next")&&"string"==typeof e.next&&e.next.length>5)}(e))):console.log("Error: get data...")}}),o.createElement(p.S,{header:"SpecialGoods List",listData:C,visible:r,setVisible:i,randerItem:Z,setSelectedItem:P,selectButtonOnClick:s}),o.createElement(V,{visible:r,setVisible:i,oldObj:y,reloadListCount:t,setReloadListCount:n}),o.createElement(G.n,{hasMore:u,onClick:H}))};M.defaultProps={reloadListCount:1,setReloadListCount:function(e){console.log(e)},requestParams:{page:0},selectButtonOnClick:null};var N=M,A=function(e){var t=e.selectButtonOnClick,n=void 0===t?null:t,a=(0,o.useRef)({page:0}),s=(0,o.useState)(1),p=s[0],f=s[1],_=(0,o.useState)(0),b=_[0],h=_[1];return o.createElement("div",null,o.createElement(r.Z,null,o.createElement(i.Z,{span:14},o.createElement(c.Z,null,o.createElement("h4",null,"SpecialGoods"),o.createElement(u.Z,{title:"刷新"},o.createElement(d.Z,{onClick:function(){a.current={page:0},f(p+1)},shape:"circle",icon:o.createElement(m.Z,null)})))),o.createElement(i.Z,{span:10},o.createElement("div",{style:{width:"100%",height:"auto"}},o.createElement(d.Z,{style:{float:"right"},type:"link",onClick:function(){return h(9)}},"增加今日特价商品")))),o.createElement(N,{reloadListCount:p,setReloadListCount:f,requestParams:a.current,selectButtonOnClick:n}),o.createElement(B.Y,{visible:b,setVisible:h,visibleNum:9,selectHandle:function(e){var t;h(0),(t=e.id,new Promise((function(e,n){var o=[].concat(y)[0]+"/"+t;(0,g.H)(o,"put",{},{special_sale:1}).then((function(t){1e3===t.code?e(t):n(t)})).catch((function(e){console.log(e),n(e)}))}))).then((function(e){console.log(e),l.ZP.success("设置 "+e.name+" 为今日特价商品成功!"),f(p+1)})).catch((function(t){console.log(t),l.ZP.error("设置今日特价商品(ID="+e.id+")失败...")}))}}))},F=function(){return o.createElement(a.Z,null,o.createElement(s.Z,{title:"WX SpecialGoods"}),o.createElement(A,null))}}}]);
//# sourceMappingURL=component---src-pages-wxspecialgoods-js-5e28d7b24867486f3171.js.map