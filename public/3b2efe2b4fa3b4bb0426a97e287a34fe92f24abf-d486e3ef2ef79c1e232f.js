(self.webpackChunkzwglass_purchase_records=self.webpackChunkzwglass_purchase_records||[]).push([[6099],{98662:function(e,t,n){"use strict";n.d(t,{XE:function(){return O},DX:function(){return I},yD:function(){return L}});var r=n(67294),c=n(40977),a=n(75334),o=n(93299),l=n(77371),s=n(54325),i=n(32210),u=n(79410),m=n(90579),f=n(50845),g=n(17858),d=function(e){var t=e.imagesList,n=e.setImagesList,c=e.deletedImageHandle,a=e.imageKeyName,l=(0,r.useRef)([]),s=function(e,t){console.log(t);var n=parseInt(t.replace(a,""));if(console.log(n),!n)return e;for(var r=[],c=0;c<e.length;c++){var o=Object.assign({},e[c]);console.log(o);var l=o.column_key?o.column_key:"0";(l=parseInt(l.replace(a,"")))>n&&(o.column_key=a+n,n+=1),console.log(o),r.push(o)}return r},i=function(e){for(var r=[].concat(t),a=0;a<t.length;a++){t[a].column_key===e&&r.splice(a,1)}console.log(s(r,e)),n(s(r,e)),function(e){for(var t=!1,n=0;n<l.length;n++)l[n]===e&&(t=!0);var r=[].concat(l.current);t||(r.push(e),l.current=r),c(r)}(e)};return r.createElement("div",{style:{textAlign:"left"}},0===t.length?null:r.createElement(u.ZP,{itemLayout:"vertical",size:"large",dataSource:t,renderItem:function(e,t){return r.createElement(u.ZP.Item,{key:t.toString(),actions:[r.createElement(m.Z,{title:"删除"},r.createElement(o.Z,{onClick:function(){return i(e.column_key)},shape:"circle",icon:r.createElement(f.Z,null)}))]},r.createElement(u.ZP.Item.Meta,{title:e.file_name,avatar:r.createElement(g.Z,{src:e.url})}))}}))};d.defaultProps={imagesList:[],setImagesList:function(e){console.log(e)},deletedImageHandle:function(e){return console.log(e)},imageKeyName:"image_cos_name"};var p={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 545.5L536.1 163a31.96 31.96 0 00-48.3 0L156 545.5a7.97 7.97 0 006 13.2h81c4.6 0 9-2 12.1-5.5L474 300.9V864c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V300.9l218.9 252.3c3 3.5 7.4 5.5 12.1 5.5h81c6.8 0 10.5-8 6-13.2z"}}]},name:"arrow-up",theme:"outlined"},_=n(12112),v=function(e,t){return r.createElement(_.Z,Object.assign({},e,{ref:t,icon:p}))};v.displayName="ArrowUpOutlined";var y=r.forwardRef(v),h={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M862 465.3h-81c-4.6 0-9 2-12.1 5.5L550 723.1V160c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v563.1L255.1 470.8c-3-3.5-7.4-5.5-12.1-5.5h-81c-6.8 0-10.5 8.1-6 13.2L487.9 861a31.96 31.96 0 0048.3 0L868 478.5c4.5-5.2.8-13.2-6-13.2z"}}]},name:"arrow-down",theme:"outlined"},E=function(e,t){return r.createElement(_.Z,Object.assign({},e,{ref:t,icon:h}))};E.displayName="ArrowDownOutlined";var b=r.forwardRef(E),Z=function(e){var t=e.imagesList,n=e.setImagesList,c=function(e,r){void 0===r&&(r=1);var c=[].concat(t),a=c.splice(e,1)[0],o=e+r;o<0||o>c.length?console.log("Insert index Error",o):(c.splice(o,0,a),n(c))};return r.createElement("div",{style:{textAlign:"left"}},0===t.length?null:r.createElement(u.ZP,{itemLayout:"vertical",size:"large",dataSource:t,renderItem:function(e,a){return r.createElement(u.ZP.Item,{key:a.toString(),actions:[r.createElement(m.Z,{title:"上移"},r.createElement(o.Z,{onClick:function(){return c(a,-1)},shape:"circle",icon:r.createElement(y,null)})),r.createElement(m.Z,{title:"下移"},r.createElement(o.Z,{onClick:function(){return c(a)},shape:"circle",icon:r.createElement(b,null)})),r.createElement(m.Z,{title:"删除"},r.createElement(o.Z,{onClick:function(){return function(e){var r=[].concat(t);r.splice(e,1),console.log(r),n(r)}(a)},shape:"circle",icon:r.createElement(f.Z,null)}))]},r.createElement(u.ZP.Item.Meta,{title:e.file_name,avatar:r.createElement(g.Z,{src:e.url})}))}}))};Z.defaultProps={imagesList:[],setImagesList:function(e){console.log(e)}};var k=n(28823),j=n(72373),S=function(e,t,n){var r={};if(1===t)r[n]=e.length>0?e[0].cos_name:"";else for(var c=0;c<t;c++){r[n+(c+1)]=e.length>c?e[c].cos_name:""}return console.log(r),r},O=function(e){var t=e.onChange,l=e.initFileList,s=e.maxFilesNum,u=e.imageKeyName,m=e.cleanImagesCount,f=(0,r.useState)(!0),g=f[0],p=f[1],_=(0,r.useRef)({}),v=(0,r.useState)(0),y=v[0],h=v[1],E=(0,r.useRef)({}),b=(0,r.useRef)({}),Z=(0,r.useState)([]),O=Z[0],I=Z[1],L=(0,r.useRef)([]);(0,r.useEffect)((function(){for(var e={file_name:"",cos_name:""},t=[],n=0;n<l.length;n++){var r=l[n];t.push(Object.assign({},r,e))}I(t)}),[l]),(0,r.useEffect)((function(){O.length>=s?p(!1):p(!0),t(S(O,s,u))}),[O,s]),(0,r.useEffect)((function(){I([]),L.current=[]}),[m]);var T=function(e,t){var n=Object.assign({},E.current),r=n.credentials;t({TmpSecretId:r.tmpSecretId,TmpSecretKey:r.tmpSecretKey,XCosSecurityToken:r.sessionToken,StartTime:n.startTime,ExpiredTime:n.expiredTime})},w={listType:"picture",fileList:[],beforeUpload:function(e){console.log(e);var t=e.name;return b.current={file_name:t},_.current=e,h(y+1),null}};return r.createElement("div",null,r.createElement(d,{imagesList:O,setImagesList:I,deletedImageHandle:function(e){return L.current=e},imageKeyName:u}),r.createElement(a.Z,w,g?r.createElement(o.Z,null,r.createElement(i.Z,null)," Upload"):null),r.createElement(k.G,{requestCount:y,reqObject:b.current,responseDataHandle:function(e){if(!Object.keys(e).includes("image_cos_name")&&!Object.keys(e).includes("sts_obj"))return console.log("Get temporary key error..."),void c.ZP.error("网络错误...");(E.current=e.sts_obj,"undefined"!=typeof window)&&new(n(74525))({getAuthorization:T}).putObject(Object.assign({},j.D1,{Key:e.image_cos_name,Body:_.current,onProgress:function(e){console.log(JSON.stringify(e))}}),(function(t,n){if(console.log(t||n),n){var r={column_key:(o=O.length+1,u+o),url:e.image_cos_name_url,cos_name:e.image_cos_name,file_name:_.current.name},a=[].concat(O);a.push(r),I(a),c.ZP.success("文件上传成功!")}else c.ZP.error("文件上传失败...");var o}))}}))};O.defaultProps={initFileList:[],fileList:[],maxFilesNum:5,onChange:function(e){console.log(e)},imageKeyName:"image_cos_name",cleanImagesCount:0};var I=function(e){var t=e.onChange,l=e.oldObj,s=e.maxImagesNum,u=e.imageKeyName,m=(0,r.useState)([]),f=m[0],g=m[1],d=(0,r.useState)(!0),p=d[0],_=d[1],v=(0,r.useState)(!1),y=v[0],h=v[1],E=(0,r.useState)(0),b=E[0],O=E[1],I=(0,r.useRef)({}),L=(0,r.useRef)({}),T=(0,r.useRef)({});(0,r.useEffect)((function(){var e=function(e,t,n){var r=[];if(1===t){var c=n+"_url";Object.keys(e).includes(c)&&r.push({column_key:n,url:e[c],file_name:"",cos_name:e[n]})}else for(var a=0;a<t;a++){var o=n+(a+1),l=o+"_url";Object.keys(e).includes(o)&&e[o].length>5&&Object.keys(e).includes(l)&&e[l].length>5&&r.push({column_key:o,url:e[l],file_name:"",cos_name:e[o]})}return r}(l,s,u);console.log(e),g(e)}),[l,s,u]),(0,r.useEffect)((function(){_(f.length<s),t(S(f,s,u))}),[f,s]);var w={accept:".jpg,.jpeg,.png,.bmp",listType:"picture",fileList:[],beforeUpload:function(e){var t=e.name;return L.current={file_name:t},I.current=e,h(!0),O(b+1),null}},C=function(e,t){var n=Object.assign({},T.current),r=n.credentials;t({TmpSecretId:r.tmpSecretId,TmpSecretKey:r.tmpSecretKey,XCosSecurityToken:r.sessionToken,StartTime:n.startTime,ExpiredTime:n.expiredTime})};return r.createElement("div",null,r.createElement(Z,{imagesList:f,setImagesList:g}),r.createElement(a.Z,w,p&&!y?r.createElement(o.Z,null,r.createElement(i.Z,null),"上传图片"):null),r.createElement(k.G,{requestCount:b,reqObject:L.current,responseDataHandle:function(e){if(!Object.keys(e).includes("image_cos_name")&&!Object.keys(e).includes("sts_obj"))return console.log("Get temporary key error..."),void c.ZP.error("网络错误...");(T.current=e.sts_obj,"undefined"!=typeof window)?new(n(74525))({getAuthorization:C}).putObject(Object.assign({},j.D1,{Key:e.image_cos_name,Body:I.current,onProgress:function(e){console.log(JSON.stringify(e))}}),(function(t,n){if(h(!1),console.log(t||n),n){var r={column_key:(o=f.length+1,u+o),url:e.image_cos_name_url,cos_name:e.image_cos_name,file_name:I.current.name},a=[].concat(f);a.push(r),g(a),c.ZP.success("文件上传成功!")}else c.ZP.error("文件上传失败...");var o})):h(!1)}}))};I.defaultProps={onChange:function(e){console.log(e)},oldObj:{handleCount:0},maxImagesNum:1,imageKeyName:"",cleanImagesCount:0};var L=function(e){var t=e.onChange,u=e.oldObj,m=e.videoKeyName,f=(0,r.useState)(!1),g=f[0],d=f[1],p=(0,r.useState)(!1),_=p[0],v=p[1],y=(0,r.useState)(""),h=y[0],E=y[1],b=(0,r.useState)(""),Z=b[0],S=b[1],O=(0,r.useRef)({}),I=(0,r.useState)(0),L=I[0],T=I[1],w=(0,r.useRef)({}),C=(0,r.useRef)({});(0,r.useEffect)((function(){if(Object.keys(u).length>0&&m.length>0){var e=m+"_url",t=u[e]?u[e]:"";E(t);var n=u[m]?u[m]:"";S(n)}}),[u,m]),(0,r.useEffect)((function(){if(console.log(m),m.length>0){var e,n=((e={})[m]=Z,e);console.log(n),t(n)}v(0===Z.length)}),[Z,m]);var P=function(e,t){var n=Object.assign({},O.current),r=n.credentials;t({TmpSecretId:r.tmpSecretId,TmpSecretKey:r.tmpSecretKey,XCosSecurityToken:r.sessionToken,StartTime:n.startTime,ExpiredTime:n.expiredTime})},K={accept:".mp4,.mov,.3gp",listType:"picture",fileList:[],beforeUpload:function(e){if(g)return null;console.log(e);var t=e.name;return w.current={file_name:t},C.current=e,T(L+1),null}};return r.createElement("div",null,r.createElement(l.Z,{direction:"vertical"},h.length>0?r.createElement("video",{width:"320",height:"240",controls:!0,src:h}):null,_?null:r.createElement(o.Z,{onClick:function(){E(""),S("")}},"删除视频"),r.createElement(a.Z,K,_?g?r.createElement(s.Z,null):r.createElement(o.Z,null,r.createElement(i.Z,null),"上传视频"):null),r.createElement(k.G,{requestCount:L,reqObject:w.current,responseDataHandle:function(e){if(console.log(e),!Object.keys(e).includes("image_cos_name")&&!Object.keys(e).includes("sts_obj"))return console.log("Get temporary key error..."),void c.ZP.error("网络错误...");(O.current=e.sts_obj,"undefined"!=typeof window)?new(n(74525))({getAuthorization:P}).putObject(Object.assign({},j.D1,{Key:e.image_cos_name,Body:C.current,onProgress:function(e){console.log(JSON.stringify(e))}}),(function(t,n){d(!1),console.log(t||n),n?(E(e.image_cos_name_url),S(e.image_cos_name),c.ZP.success("视频上传成功!")):c.ZP.error("视频上传失败...")})):d(!1)}})))};L.defaultProps={onChange:function(e){return console.log(e)},oldObj:{},videoKeyName:""}}}]);
//# sourceMappingURL=3b2efe2b4fa3b4bb0426a97e287a34fe92f24abf-d486e3ef2ef79c1e232f.js.map